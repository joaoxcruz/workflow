@startuml US230_RegisterShowRequest_SD
autonumber
actor "CRM Collaborator" as User
participant ":RegisterShowRequestUI" as UI
participant ":RegisterShowRequestController" as Ctrl
participant "customerRepo : CustomerRepository" as CustRepo
participant "showRequestRepo : ShowRequestRepository" as SRRepo
participant "request : ShowRequest" as Request

activate User
User -> UI : Selects "Register Show Request" option
activate UI
UI -> Ctrl : getActiveCustomers()
activate Ctrl
Ctrl -> CustRepo : findActive()
activate CustRepo
CustRepo --> Ctrl : activeCustomerList
deactivate CustRepo
Ctrl --> UI : activeCustomerList
deactivate Ctrl
UI --> User : Shows list of active customers, asks for selection
User -> UI : Selects customer (e.g., by VAT)
UI --> User : Asks for place, dateTime, duration, droneCount, descriptionRef
User -> UI : Enters request details
UI -> Ctrl : registerShowRequest(customerVAT, place, dateTime, duration, droneCount, descriptionRef)
activate Ctrl
Ctrl -> CustRepo : findByVAT(customerVAT)
activate CustRepo
CustRepo --> Ctrl : optionalCustomer
deactivate CustRepo
alt Customer found and active
    Ctrl -> Request** : create(customer, place, dateTime, duration, droneCount, descriptionRef)
    activate Request
    Request --> Ctrl : showRequest
    deactivate Request
    Ctrl -> SRRepo : save(showRequest)
    activate SRRepo
    SRRepo --> Ctrl : persistedShowRequest
    deactivate SRRepo
    Ctrl --> UI : Success confirmation
else Customer not found or inactive
    Ctrl --> UI : Error message (Customer invalid/inactive)
end
deactivate Ctrl
UI --> User : Shows success or error message
deactivate UI
deactivate User
@enduml