@startuml design/sequence-diagram-235_with_db.svg

autonumber
title Sequence Diagram: US235 - List Show Requests of Client

actor "CRM User" as User
participant ":ListClientShowRequestsUI" as UI
participant ":ListClientShowRequestsController" as Ctrl
participant "clientRepo : ClientRepository" as ClientRepo
participant "showRequestRepo : ShowRequestRepository" as SRRepo
participant "dto : ShowRequestSummaryDTO" as DTO
database "Database" as DB

activate User
User -> UI : Selects "List Client Show Requests" option
activate UI

UI -> Ctrl : getAllClientsForSelection()
activate Ctrl
Ctrl -> ClientRepo : findAll()
activate ClientRepo
ClientRepo -> DB : Executes query (e.g., SELECT c FROM Client c)
activate DB
DB --> ClientRepo : Returns Client records/data
deactivate DB
ClientRepo --> Ctrl : clientList: Iterable<Client>
deactivate ClientRepo
Ctrl --> UI : clientList
deactivate Ctrl

UI --> User : Shows list of clients, asks for selection
User -> UI : Selects client(selectedClientVAT)

UI -> Ctrl : listShowRequestsForClient(selectedClientVAT)
activate Ctrl
Ctrl -> SRRepo : findByClientVAT(selectedClientVAT)
activate SRRepo
SRRepo -> DB : Executes query
activate DB
DB --> SRRepo : Returns ShowRequest records/data matching VAT
deactivate DB
SRRepo --> Ctrl : requestList: Iterable<ShowRequest>
deactivate SRRepo

loop for each ShowRequest in requestList
    Ctrl -> DTO** : create(request.submissionDate(), request.place(), request.status())
    activate DTO
    DTO --> Ctrl : showRequestDTO
    deactivate DTO
end

Ctrl --> UI : dtoList: Iterable<ShowRequestSummaryDTO>
deactivate Ctrl

UI --> User : Displays formatted list of ShowRequestSummaryDTOs
deactivate UI

deactivate User

@enduml